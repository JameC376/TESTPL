<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Volleyball World HLS Player</title>

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet"/>

  <!-- HLS.js -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <style>
    :root {
      --bg: #0d1117;
      --card: #161b22;
      --accent: #58a6ff;
      --text: #c9d1d9;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      height: 100%; font-family: 'Inter', sans-serif;
      background: var(--bg); color: var(--text);
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      padding: 1rem;
    }
    h1 {
      color: var(--accent); margin-bottom: 1rem;
    }
    #player { 
      width: 100%; max-width: 800px;
      border-radius: 8px; overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      background: #000;
    }
    video {
      width: 100%; height: auto;
      display: block;
    }
    #error {
      margin-top: 1rem; color: #f85149;
    }
  </style>
</head>
<body>

  <h1>Volleyball World Live Stream</h1>
  <div id="player">
    <video id="video" controls autoplay muted></video>
  </div>
  <div id="error"></div>

  <script>
  (async () => {
    const video = document.getElementById('video');
    const errorBox = document.getElementById('error');
    const target = 'https://kalanchoe.micinproject.de/volleyballworld/idx-eMqXVhhW/pages';
    const proxy  = 'https://cors-anywhere.herokuapp.com/';

    try {
      // ดึง HTML หน้าเป้าหมาย (ผ่าน proxy ถ้าจำเป็น)
      const html = await fetch(proxy + target).then(r => r.text());
      const doc  = new DOMParser().parseFromString(html, 'text/html');

      // หา <source type="application/x-mpegURL">
      let src = doc.querySelector('source[type="application/x-mpegURL"]')?.src
             || doc.querySelector('video[src$=".m3u8"]')?.src
             || '';

      if (!src) throw new Error('ไม่พบลิงก์ .m3u8');

      // ถ้าเป็น relative path
      if (!src.startsWith('http')) {
        src = new URL(src, target).href;
      }

      // เล่นด้วย HLS.js (for non–Safari browsers)
      if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(src);
        hls.attachMedia(video);
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = src;
      } else {
        throw new Error('Browser ไม่รองรับ HLS');
      }
    } catch (err) {
      console.error(err);
      errorBox.textContent = 'เกิดข้อผิดพลาด: ' + err.message;
    }
  })();
  </script>
</body>
</html>
