<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>HLS Stream Selector</title>

  <!-- Video.js CSS -->
  <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet"/>

  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      background: #000;
      display: flex; flex-direction: column;
      align-items: center; justify-content: start;
    }

    #menu-container {
      width: 100%; max-width: 800px;
      padding: 1rem;
      box-sizing: border-box;
      background: #111;
      color: #fff;
    }

    #stream-menu {
      width: 100%; padding: .5rem;
      font-size: 1rem;
      margin-top: .5rem;
      background: #222; color: #fff;
      border: 1px solid #444; border-radius: 4px;
    }

    .video-js {
      width: 100%; max-width: 800px;
      margin-top: .5rem;
    }

    .vjs-control-bar {
      background: rgba(0,0,0,0.6);
    }
  </style>
</head>
<body>

  <div id="menu-container">
    <h2>เลือกช่องสตรีม</h2>
    <select id="stream-menu">
      <option value="">-- กำลังโหลดลิสต์สตรีม --</option>
    </select>
  </div>

  <video
    id="hls-player"
    class="video-js vjs-default-skin vjs-fluid"
    controls autoplay muted preload="auto"
  ></video>

  <!-- Video.js -->
  <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>

  <script>
  (async () => {
    const menu = document.getElementById('stream-menu');
    let player = videojs('hls-player', { fluid: true });

    try {
      // ถ้าถูกบล็อคให้ใช้ proxy ของคุณเอง
      const raw = await fetch(
        'https://cors-anywhere.herokuapp.com/https://halu.serv00.net/poli.php'
      ).then(r => r.text());

      const doc = new DOMParser().parseFromString(raw, 'text/html');
      const sources = [];

      // หา <video><source> ทุกตัว
      doc.querySelectorAll('video source[type="application/x-mpegURL"]').forEach((el, i) => {
        let url = el.src.trim();
        if (!url) return;
        if (!url.startsWith('http')) {
          url = new URL(url, 'https://halu.serv00.net').href;
        }
        sources.push({ name: `Channel ${i+1}`, url });
      });

      // หา <iframe> ถ้ามี
      doc.querySelectorAll('iframe').forEach((el, i) => {
        let url = el.src.trim();
        if (!url) return;
        if (!url.startsWith('http')) {
          url = new URL(url, 'https://halu.serv00.net').href;
        }
        sources.push({ name: `Embed ${i+1}`, url });
      });

      if (!sources.length) {
        throw new Error('ไม่พบสตรีม .m3u8 ใดๆ');
      }

      // ทำเมนู
      menu.innerHTML = '<option value="">-- เลือกช่องสตรีม --</option>';
      sources.forEach(s => {
        const opt = document.createElement('option');
        opt.value = s.url;
        opt.textContent = s.name;
        menu.appendChild(opt);
      });

      // เมื่อเปลี่ยนเลือกสตรีม
      menu.addEventListener('change', () => {
        const url = menu.value;
        if (!url) return;
        player.pause();
        player.src({ src: url, type: 'application/x-mpegURL' });
        player.play();
      });

      // เลือกตัวแรกอัตโนมัติ
      menu.selectedIndex = 1;
      menu.dispatchEvent(new Event('change'));

    } catch (err) {
      console.error(err);
      document.getElementById('menu-container').innerHTML =
        '<p style="color:#f88;">เกิดข้อผิดพลาด: ' + err.message + '</p>';
    }
  })();
  </script>
</body>
</html>
